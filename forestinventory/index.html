<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Forest Inventory</title>
    <!-- Chosen Palette: Warm Neutrals & Earth Tones -->
    <!-- Application Structure Plan: A single-page application with persistent side navigation for non-linear exploration. The structure follows a learning journey: 1. Intro (Why Sample?), 2. Concepts (Key Metrics), 3. Methods (Interactive Toolkit for Fixed vs. Variable Radius), 4. Challenges (Practical Field Issues), 5. Decisions (Interactive Stocking Guide). This modular, task-oriented design enhances usability and understanding by breaking down dense topics into interactive, digestible chunks, moving from theory to practical application. -->
    <!-- Visualization & Content Choices: 
        - Intro (Census vs. Sample): Goal: Compare -> Method: Side-by-side HTML cards -> Interaction: Visual contrast -> Justification: Simple, high-impact visual metaphor.
        - Key Metrics: Goal: Inform/Relate -> Method: Dashboard layout with stat callouts and a Chart.js Donut chart for Basal Area -> Interaction: Hover tooltips -> Justification: Provides a quick reference dashboard for core concepts.
        - Sampling Methods: Goal: Compare/Demonstrate -> Method: Tabbed interface with HTML/CSS animated diagrams and JS calculators -> Interaction: Clicks trigger calculations and visual state changes -> Justification: Actively engages users in the 'how-to' process, reinforcing learning through doing.
        - Stocking Guide: Goal: Relate/Decide -> Method: Chart.js Scatter plot with colored background regions -> Interaction: Buttons dynamically add stand data to the chart and update a recommendation text block -> Justification: Connects abstract data directly to tangible management outcomes, the chapter's key takeaway.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. 
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #FDFBF7; font-family: 'Lato', sans-serif; }
        h1, h2, h3, .font-display { font-family: 'Merriweather', serif; }
        :root {
            --color-primary: #4A5C4D;
            --color-secondary: #A4B099;
            --color-accent: #C4A484;
            --color-text: #3D403A;
            --color-bg: #FDFBF7;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            border-left: 3px solid transparent;
        }
        .nav-link.active {
            border-left-color: var(--color-accent);
            color: var(--color-primary);
            background-color: #F5F1E9;
            transform: translateX(4px);
        }
        .tab.active {
            background-color: var(--color-primary);
            color: var(--color-bg);
        }
        .baf-tree { transition: all 0.3s ease-in-out; }
    </style>
</head>
<body class="text-[var(--color-text)]">

<div class="flex">
    <aside class="sticky top-0 h-screen w-64 bg-[#F5F1E9] p-6 hidden lg:block overflow-y-auto">
        <h2 class="font-display text-xl font-bold text-[var(--color-primary)] mb-6">Forest Sampling</h2>
        <nav id="desktop-nav" class="space-y-2">
            <a href="#intro" class="nav-link block p-3 rounded-r-lg font-semibold">The Why: Intro</a>
            <a href="#concepts" class="nav-link block p-3 rounded-r-lg font-semibold">The What: Metrics</a>
            <a href="#methods" class="nav-link block p-3 rounded-r-lg font-semibold">The How: Methods</a>
            <a href="#challenges" class="nav-link block p-3 rounded-r-lg font-semibold">Field Challenges</a>
            <a href="#decisions" class="nav-link block p-3 rounded-r-lg font-semibold">Data to Decisions</a>
            <a href="#selector" class="nav-link block p-3 rounded-r-lg font-semibold">Choose Your Tool</a>
        </nav>
    </aside>

    <main class="w-full min-w-0">
        <div class="max-w-4xl mx-auto p-4 md:p-10">

            <section id="intro" class="min-h-screen py-10">
                <h1 class="font-display text-4xl md:text-5xl font-bold text-center text-[var(--color-primary)]">The Forester's Dilemma</h1>
                <p class="text-center text-lg mt-4 mb-12">Why walk past thousands of trees to measure only a few? This application explores why sampling isn't just a shortcut—it's often the better way to understand a forest.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-gray-300">
                        <h3 class="font-display text-2xl font-bold text-center mb-4">Census: Measure Everything</h3>
                        <p class="text-center text-6xl mb-4">🌳🌳🌳🌳</p>
                        <p class="text-center mb-4">In theory, a census offers perfect accuracy by measuring every single tree. There is no uncertainty from sampling.</p>
                        <ul class="space-y-2">
                            <li class="flex items-start"><span class="text-red-600 font-bold mr-2">✗</span><span><strong>Impractical:</strong> Prohibitively expensive and time-consuming for large areas.</span></li>
                            <li class="flex items-start"><span class="text-red-600 font-bold mr-2">✗</span><span><strong>Error-Prone:</strong> Crew fatigue over thousands of measurements leads to high non-sampling (human) error.</span></li>
                        </ul>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-[var(--color-primary)]">
                        <h3 class="font-display text-2xl font-bold text-center text-[var(--color-primary)] mb-4">Sample: Measure a Few</h3>
                        <p class="text-center text-6xl mb-4">🌿</p>
                        <p class="text-center mb-4">By measuring a representative subset, we can make statistically sound inferences about the whole forest.</p>
                        <ul class="space-y-2">
                            <li class="flex items-start"><span class="text-green-600 font-bold mr-2">✓</span><span><strong>Efficient:</strong> Far lower cost allows for better tools and more skilled personnel.</span></li>
                            <li class="flex items-start"><span class="text-green-600 font-bold mr-2">✓</span><span><strong>More Accurate?:</strong> The reduction in human error can outweigh the calculated sampling error, often yielding a better final result.</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <hr class="my-16 border-t-2 border-[var(--color-secondary)]/30">
            
            <section id="concepts" class="min-h-screen py-10">
                <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--color-primary)]">The Language of the Stand</h2>
                <p class="text-center text-lg max-w-3xl mx-auto mb-12">Foresters use a common language of metrics to describe a stand's character. This section introduces the three most fundamental measures that turn tree tallies into powerful insights.</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md text-center">
                        <h3 class="font-display text-xl font-bold mb-2">Trees Per Acre (TPA)</h3>
                        <p class="font-display text-5xl font-bold text-[var(--color-primary)] my-4">84</p>
                        <p>The simplest measure of density. While intuitive, it doesn't account for tree size—84 saplings are very different from 84 mature oaks.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md text-center">
                        <h3 class="font-display text-xl font-bold mb-2">Basal Area (BA)</h3>
                         <div class="chart-container h-40 mx-auto my-4">
                            <canvas id="baDonutChart"></canvas>
                        </div>
                        <p>The cross-sectional area of trees per acre (ft²/ac). It's the best single indicator of how "crowded" a stand is and how much growing space is used.</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md text-center">
                        <h3 class="font-display text-xl font-bold mb-2">Quadratic Mean Diameter (QMD)</h3>
                        <p class="font-display text-5xl font-bold text-[var(--color-primary)] my-4">15.6"</p>
                        <p>The diameter of the tree of average basal area. It gives more weight to larger trees, providing a more representative average size than a simple mean.</p>
                    </div>
                </div>
            </section>
            
            <hr class="my-16 border-t-2 border-[var(--color-secondary)]/30">

            <section id="methods" class="min-h-screen py-10">
                <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--color-primary)]">The Forester's Toolkit</h2>
                 <p class="text-center text-lg max-w-3xl mx-auto mb-12">The choice of sampling method depends entirely on the inventory's objective. Explore the two foundational techniques to understand their unique principles, procedures, and calculations.</p>

                <div class="flex justify-center mb-8">
                    <div class="flex space-x-1 bg-[#E8E4DB] p-1 rounded-lg">
                        <button class="tab active px-6 py-2 rounded-md font-semibold" onclick="switchTab('fixed')">Fixed-Radius Plot</button>
                        <button class="tab px-6 py-2 rounded-md font-semibold" onclick="switchTab('variable')">Variable-Radius Plot</button>
                    </div>
                </div>

                <div id="fixed-content" class="method-tab">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="font-display text-xl font-bold mb-2">Principle: Equal Probability</h3>
                            <p class="mb-4">A circular plot of a fixed, known area (e.g., 1/10th acre) is established. Every tree inside the boundary has an equal chance of being sampled, regardless of its size.</p>
                            <div class="w-full aspect-square bg-[#F5F1E9] rounded-lg relative border-2 border-dashed border-[var(--color-secondary)]" id="fixedPlotArea">
                                <div class="tree absolute w-4 h-4 rounded-full bg-green-800" style="top: 20%; left: 30%;"></div>
                                <div class="tree absolute w-8 h-8 rounded-full bg-green-800" style="top: 40%; left: 50%;"></div>
                                <div class="tree absolute w-5 h-5 rounded-full bg-green-800" style="top: 60%; left: 25%;"></div>
                                <div class="tree absolute w-6 h-6 rounded-full bg-gray-400" style="top: 15%; left: 80%;"></div>
                                <div class="tree absolute w-10 h-10 rounded-full bg-gray-400" style="top: 70%; left: 75%;"></div>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-2 h-2 bg-red-500 rounded-full" title="Plot Center"></div>
                                </div>
                                <p class="absolute bottom-2 right-2 text-sm text-gray-500">Gray trees are "out"</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md flex flex-col">
                            <h3 class="font-display text-xl font-bold mb-2">Interactive Calculation: TPA</h3>
                            <p class="mb-4">For a <strong>1/20th acre plot</strong>, the expansion factor is 20. This means each tallied tree represents 20 trees per acre.</p>
                            <div class="bg-[#F5F1E9] p-4 rounded-lg flex-grow">
                                <p class="font-semibold">In your 1/20th acre plot, you tally 3 trees.</p>
                                <button id="calcTpaBtn" class="bg-[var(--color-accent)] text-white font-bold py-2 px-4 rounded-lg my-4 hover:bg-opacity-80 transition">Calculate Stand TPA</button>
                                <p id="tpaResult" class="font-display text-3xl font-bold text-[var(--color-primary)] h-12"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="variable-content" class="method-tab hidden">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="font-display text-xl font-bold mb-2">Principle: Probability Proportional to Size</h3>
                            <p class="mb-4">Using an angle gauge (prism), a tree is "in" if it's large enough or close enough. Big trees can be sampled from farther away. This efficiently focuses on trees that contribute most to volume.</p>
                             <div class="w-full aspect-square bg-[#F5F1E9] rounded-lg relative overflow-hidden flex items-center justify-center p-4">
                                <div id="prism-viewer" class="relative w-full h-full">
                                    <div class="baf-tree absolute rounded-full bg-green-700" data-size="30" style="width: 30px; height: 30px; top: 15%; left: 20%;"></div>
                                    <div class="baf-tree absolute rounded-full bg-green-700" data-size="80" style="width: 80px; height: 80px; top: 50%; left: 55%;"></div>
                                    <div class="baf-tree absolute rounded-full bg-green-700" data-size="50" style="width: 50px; height: 50px; top: 60%; left: 10%;"></div>
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                                        <div class="font-bold text-red-600">👁️</div>
                                        <p class="text-xs">You are here</p>
                                    </div>
                                </div>
                                 <p id="prism-status" class="absolute top-2 left-2 font-bold text-lg"></p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md flex flex-col">
                            <h3 class="font-display text-xl font-bold mb-2">Interactive Calculation: Basal Area</h3>
                            <p class="mb-4">Using a <strong>BAF 10 prism</strong> is simple: every "in" tree represents exactly 10 ft² of Basal Area per acre.</p>
                            <div class="bg-[#F5F1E9] p-4 rounded-lg flex-grow">
                                <p class="font-semibold">At your sample point, you tally 7 "in" trees.</p>
                                <button id="calcBaBtn" class="bg-[var(--color-accent)] text-white font-bold py-2 px-4 rounded-lg my-4 hover:bg-opacity-80 transition">Calculate Stand BA</button>
                                <p id="baResult" class="font-display text-3xl font-bold text-[var(--color-primary)] h-12"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-16 border-t-2 border-[var(--color-secondary)]/30">

            <section id="challenges" class="min-h-screen/2 py-10">
                <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--color-primary)]">Common Field Challenges</h2>
                <p class="text-center text-lg max-w-3xl mx-auto mb-12">The forest is not a perfect grid. Crews must consistently handle two major sources of error: sloped ground and borderline trees.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div class="bg-white p-6 rounded-lg shadow-md">
                         <h3 class="font-display text-xl font-bold mb-2">Slope Correction</h3>
                         <p>Measuring distance on a slope is longer than the true horizontal distance. Failing to correct for this shrinks your plot and introduces bias. Field crews use corrected radii or tilt their prism to compensate.</p>
                         <div class="chart-container h-48 mt-4"><canvas id="slopeChart"></canvas></div>
                     </div>
                     <div class="bg-white p-6 rounded-lg shadow-md">
                         <h3 class="font-display text-xl font-bold mb-2">The Borderline Tree</h3>
                         <p>Relying on judgment for "in" or "out" is a major source of error. The rule is simple: when in doubt, measure. A quick check of the tree's diameter and its distance from plot center provides an objective answer.</p>
                         <div class="mt-4 bg-[#F5F1E9] p-4 rounded-lg text-center">
                            <p class="font-semibold">Limiting Distance (ft) =</p>
                            <p class="font-display text-xl">DBH (in) × Plot Radius Factor</p>
                        </div>
                     </div>
                </div>
            </section>

            <hr class="my-16 border-t-2 border-[var(--color-secondary)]/30">

            <section id="decisions" class="min-h-screen py-10">
                 <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--color-primary)]">From Data to Decisions</h2>
                <p class="text-center text-lg max-w-3xl mx-auto mb-12">Inventory data comes to life when plotted on a stocking guide. This tool shows if a stand is overstocked, fully stocked, or understocked, directly informing management actions like thinning or habitat improvement.</p>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="chart-container md:col-span-2 h-96"><canvas id="stockingChart"></canvas></div>
                    <div class="mt-6 text-center">
                        <p class="font-semibold mb-2">Plot a typical stand condition:</p>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button class="stand-btn bg-[var(--color-secondary)] hover:bg-opacity-80 text-white py-1 px-3 rounded-full" data-ba="130" data-tpa="350">Young, Dense Pine</button>
                            <button class="stand-btn bg-[var(--color-secondary)] hover:bg-opacity-80 text-white py-1 px-3 rounded-full" data-ba="110" data-tpa="150">Mature Hardwood</button>
                            <button class="stand-btn bg-[var(--color-secondary)] hover:bg-opacity-80 text-white py-1 px-3 rounded-full" data-ba="70" data-tpa="250">Recently Thinned</button>
                             <button class="stand-btn bg-[var(--color-secondary)] hover:bg-opacity-80 text-white py-1 px-3 rounded-full" data-ba="40" data-tpa="50">Wildlife Opening</button>
                        </div>
                        <div id="stocking-recommendation" class="mt-4 p-4 bg-[#F5F1E9] rounded-lg h-24 text-left">
                            <p class="italic">Click a stand type to see its condition and management recommendation.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <hr class="my-16 border-t-2 border-[var(--color-secondary)]/30">

            <section id="selector" class="min-h-screen/2 py-10">
                <h2 class="font-display text-3xl md:text-4xl font-bold text-center mb-4 text-[var(--color-primary)]">Choose Your Tool</h2>
                <p class="text-center text-lg max-w-3xl mx-auto mb-12">Based on what you've learned, which method is best for the job? Test your understanding with these common forestry scenarios.</p>
                <div id="quiz-container" class="bg-white p-6 rounded-lg shadow-md">
                    <div id="quiz-question" class="mb-4">
                        <p class="font-semibold text-lg"></p>
                    </div>
                    <div id="quiz-options" class="space-y-2 mb-4"></div>
                    <div id="quiz-feedback" class="p-3 rounded-lg h-20"></div>
                </div>
            </section>

        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tooltipCallback = {
            plugins: { tooltip: { callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    return Array.isArray(label) ? label.join(' ') : label;
                }
            }}}
        };

        const chartColors = {
            primary: 'rgba(74, 92, 77, 1)',
            secondary: 'rgba(164, 176, 153, 1)',
            accent: 'rgba(196, 164, 132, 1)',
            text: 'rgba(61, 64, 58, 1)',
            bg: 'rgba(253, 251, 247, 1)',
            bgMuted: 'rgba(245, 241, 233, 1)'
        };

        new Chart(document.getElementById('baDonutChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Site Occupied (BA)', 'Growth Potential'],
                datasets: [{ data: [120, 60], backgroundColor: [chartColors.primary, chartColors.bgMuted], borderColor: [chartColors.primary, chartColors.secondary], borderWidth: 1 }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false }, ...tooltipCallback.plugins } }
        });
        
        new Chart(document.getElementById('slopeChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['0%', '20%', '40%', '60%'],
                datasets: [{ 
                    label: 'Required Plot Radius', 
                    data: [37.2, 37.9, 40.0, 43.3],
                    borderColor: chartColors.accent,
                    backgroundColor: 'rgba(196, 164, 132, 0.2)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: {y: {title: {display: true, text: 'Corrected Radius (ft) for 1/10 ac'}}}, plugins: { legend: { display: false }, ...tooltipCallback.plugins } }
        });

        const stockingChartCtx = document.getElementById('stockingChart').getContext('2d');
        const stockingChart = new Chart(stockingChartCtx, {
            type: 'scatter',
            data: {
                datasets: [
                    { label: 'Overstocked (A-Line)', data: [{x: 0, y: 500}, {x: 200, y: 700}], showLine: true, fill: {target: 'end', above: 'rgba(239, 68, 68, 0.1)'}, borderColor: 'rgba(239, 68, 68, 0.3)', pointRadius: 0 },
                    { label: 'Fully Stocked (B-Line)', data: [{x: 0, y: 300}, {x: 200, y: 500}], showLine: true, fill: {target: {value: 0}, above: 'rgba(34, 197, 94, 0.1)'}, borderColor: 'rgba(34, 197, 94, 0.3)', pointRadius: 0 },
                    { label: 'Current Stand', data: [], backgroundColor: chartColors.primary, pointRadius: 10, pointHoverRadius: 12 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { type: 'linear', position: 'bottom', title: { display: true, text: 'Basal Area (ft²/acre)' }, min: 0, max: 200 },
                    y: { title: { display: true, text: 'Trees Per Acre (TPA)' }, min: 0, max: 800 }
                },
                plugins: {
                    tooltip: { callbacks: {
                        label: function(context) {
                            if (context.dataset.label === 'Current Stand') return `Stand: ${context.parsed.y} TPA, ${context.parsed.x} BA`;
                            return false;
                        }
                    }},
                    legend: { labels: { filter: item => item.datasetIndex === 2 } }
                }
            }
        });

        document.querySelectorAll('.stand-btn').forEach(button => {
            button.addEventListener('click', function() {
                const ba = parseFloat(this.dataset.ba);
                const tpa = parseFloat(this.dataset.tpa);
                stockingChart.data.datasets[2].data = [{x: ba, y: tpa}];
                stockingChart.update();
                updateRecommendation(ba, tpa, this.innerText);
            });
        });

        function updateRecommendation(ba, tpa, name) {
            const recommendationEl = document.getElementById('stocking-recommendation');
            let recommendationText = `<strong>${name}:</strong> A stand with ${tpa} TPA and ${ba} BA is `;
            if (ba > 120 || (ba > 80 && tpa > 400)) {
                recommendationText += "<strong class='text-red-700'>Overstocked</strong>. It is experiencing high competition, leading to slow growth and mortality. A thinning is recommended to reduce BA and improve stand health.";
            } else if (ba < 60 && tpa < 200) {
                recommendationText += "<strong class='text-blue-700'>Understocked</strong>. The site's growing space is not fully utilized. Management might focus on regeneration to increase future density.";
            } else {
                recommendationText += "<strong class='text-green-700'>Fully Stocked</strong>. The stand is efficiently using the site's resources for optimal growth. Monitor for future thinning needs.";
            }
            recommendationEl.innerHTML = recommendationText;
        }

        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('main section');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    navLinks.forEach(link => {
                        link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                    });
                }
            });
        }, { rootMargin: "-50% 0px -50% 0px", threshold: 0 });
        sections.forEach(section => observer.observe(section));

        document.getElementById('calcTpaBtn').addEventListener('click', () => {
            const resultEl = document.getElementById('tpaResult');
            resultEl.innerHTML = "3 trees &times; 20 = <span class='text-[var(--color-accent)]'>60 TPA</span>";
        });

        document.getElementById('calcBaBtn').addEventListener('click', () => {
            const resultEl = document.getElementById('baResult');
            resultEl.innerHTML = "7 trees &times; 10 BAF = <span class='text-[var(--color-accent)]'>70 ft²/ac</span>";
        });
        
        const prismViewer = document.getElementById('prism-viewer');
        const prismStatus = document.getElementById('prism-status');
        prismViewer.addEventListener('mousemove', (e) => {
            if(e.target.classList.contains('baf-tree')) {
                const tree = e.target;
                const rect = prismViewer.getBoundingClientRect();
                const viewer_x = rect.left + rect.width / 2;
                const viewer_y = rect.top + rect.height / 2;
                const tree_x = e.clientX;
                const tree_y = e.clientY;

                const distance = Math.sqrt(Math.pow(tree_x-viewer_x,2) + Math.pow(tree_y-viewer_y,2));
                const tree_size = parseInt(tree.dataset.size);

                const limiting_dist = tree_size * 2.75; 

                if (distance < limiting_dist * 0.95) {
                    prismStatus.textContent = "IN";
                    prismStatus.className = "absolute top-2 left-2 font-bold text-lg text-green-600";
                    tree.style.transform = 'translateX(15px)';
                } else if (distance > limiting_dist * 1.05) {
                    prismStatus.textContent = "OUT";
                    prismStatus.className = "absolute top-2 left-2 font-bold text-lg text-red-600";
                    tree.style.transform = 'translateX(25px)';
                } else {
                    prismStatus.textContent = "BORDERLINE";
                    prismStatus.className = "absolute top-2 left-2 font-bold text-lg text-yellow-500";
                    tree.style.transform = 'translateX(20px)';
                }
            }
        });
         prismViewer.addEventListener('mouseleave', () => {
            prismStatus.textContent = "";
            document.querySelectorAll('.baf-tree').forEach(t => t.style.transform = 'translateX(0)');
        });

        const quizData = [
            { question: "Your primary goal is to estimate timber volume in a mature, uneven-aged hardwood stand. Which method is most efficient?", options: ["Fixed-Radius Plot", "Variable-Radius Plot (Prism)"], answer: 1 },
            { question: "You need to accurately count the number of newly planted seedlings per acre for a survival check. Which method should you use?", options: ["Fixed-Radius Plot", "Variable-Radius Plot (Prism)"], answer: 0 },
            { question: "You are creating a permanent plot to monitor long-term changes in forest structure, including small understory plants. Which is the only suitable method?", options: ["Fixed-Radius Plot", "Variable-Radius Plot (Prism)"], answer: 0 }
        ];
        let currentQuestionIndex = 0;

        function loadQuizQuestion() {
            const questionEl = document.querySelector('#quiz-question p');
            const optionsEl = document.getElementById('quiz-options');
            const feedbackEl = document.getElementById('quiz-feedback');
            
            questionEl.textContent = quizData[currentQuestionIndex].question;
            optionsEl.innerHTML = '';
            feedbackEl.innerHTML = '';
            feedbackEl.className = 'p-3 rounded-lg h-20';

            quizData[currentQuestionIndex].options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'block w-full text-left p-3 bg-[#F5F1E9] rounded-lg hover:bg-[var(--color-secondary)] hover:text-white transition';
                button.onclick = () => checkAnswer(index);
                optionsEl.appendChild(button);
            });
        }
        
        function checkAnswer(selectedIndex) {
            const feedbackEl = document.getElementById('quiz-feedback');
            const correctIndex = quizData[currentQuestionIndex].answer;
            if (selectedIndex === correctIndex) {
                feedbackEl.className = 'p-3 rounded-lg h-20 bg-green-100 text-green-800';
                feedbackEl.innerHTML = `<strong>Correct!</strong> ${correctIndex === 0 ? 'Fixed plots give unbiased counts of all tree sizes.' : 'Variable-radius plots are most efficient for BA and volume.'}`;
            } else {
                feedbackEl.className = 'p-3 rounded-lg h-20 bg-red-100 text-red-800';
                feedbackEl.innerHTML = `<strong>Not quite.</strong> The best choice is ${quizData[currentQuestionIndex].options[correctIndex]}. Try to think about the core principle of each method.`;
            }
            setTimeout(() => {
                currentQuestionIndex = (currentQuestionIndex + 1) % quizData.length;
                loadQuizQuestion();
            }, 3000);
        }

        loadQuizQuestion();
    });

    function switchTab(tabName) {
        document.querySelectorAll('.method-tab').forEach(tab => {
            tab.classList.add('hidden');
        });
        document.getElementById(tabName + '-content').classList.remove('hidden');

        document.querySelectorAll('.tab').forEach(button => {
            button.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
    }
</script>

</body>
</html>
